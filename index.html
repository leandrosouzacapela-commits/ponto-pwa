<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Ponto</title>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(180deg, #0b1220, #0f172a);
  color: #ffffff;
  text-align: center;
}

.container {
  max-width: 900px;
  margin: 0 auto;
  padding: 40px 20px;
}

h1 {
  font-size: 36px;
  margin-bottom: 20px;
}

.info {
  margin: 6px 0;
  font-size: 18px;
}

button {
  width: 100%;
  padding: 22px;
  margin: 14px 0;
  font-size: 22px;
  border-radius: 12px;
  border: none;
  color: #fff;
  cursor: pointer;
}

.btn-entrar { background: #22c55e; }
.btn-sair   { background: #ef4444; }
.btn-rel    { background: #2563eb; }

.status-box {
  margin: 18px 0;
  padding: 14px;
  border-radius: 10px;
  font-size: 20px;
  background: #16a34a;
}

.hidden { display: none; }

/* ================= RELATÓRIO ================= */
#relatorio {
  display: none;
  background: #ffffff;
  color: #000000;
  padding: 25px;
  margin-top: 20px;
  text-align: left;
}

#relatorio h2 {
  text-align: center;
  font-size: 20px;
}

#relatorio h3 {
  text-align: center;
  font-size: 18px;
}

#periodoRelatorio {
  text-align: center;
  font-weight: bold;
  margin: 10px 0;
}

#boxTotalHoras {
  border: 2px solid #2563eb;
  border-radius: 10px;
  padding: 16px;
  text-align: center;
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 20px;
}

/* ===== IMPRESSÃO CORRIGIDA ===== */
@media print {

  body {
    background: #ffffff !important;
    color: #000000 !important;
  }

  .container > *:not(#relatorio) {
    display: none !important;
  }

  #relatorio {
    display: block !important;
    background: #ffffff !important;
    color: #000000 !important;
  }

  #relatorio * {
    color: #000000 !important;
  }
}
</style>
</head>

<body>

<div class="container">

  <h1>Controle de Ponto</h1>

  <div class="info"><strong>Funcionário:</strong></div>
  <div class="info">
    <input id="nomeFuncionario"
      value="EDENILSON DE SOUZA PEREIRA"
      onblur="salvarNome()"
      style="background:transparent;border:none;color:#fff;font-size:18px;font-weight:bold;text-align:center;width:100%;outline:none;">
  </div>

  <div class="info" id="dataHora"></div>
  <div class="info" id="statusAtual"></div>
  <div class="info" id="ultimaAcao"></div>

  <button class="btn-entrar" onclick="registrar('ENTRADA')">ENTRAR</button>
  <button class="btn-sair" onclick="registrar('SAIDA')">SAIR</button>

  <div id="statusEnvio" class="status-box hidden">✔ Registro enviado</div>

  <button class="btn-rel" onclick="toggleRelatorio()">RELATÓRIO / PDF</button>

  <div id="relatorio">
    <h2>RELATÓRIO DE PONTO</h2>
    <h3 id="tituloFuncionario"></h3>
    <div id="periodoRelatorio"></div>

    <div id="boxTotalHoras">TOTAL: 00h:00min</div>
    <div id="conteudoRel"></div>

    <br>
    <button onclick="window.print()">Imprimir / Salvar PDF</button>
  </div>

</div>

<script>
setInterval(()=> {
  const d=new Date();
  dataHora.innerText="Hoje: "+d.toLocaleDateString()+" — "+d.toLocaleTimeString();
},1000);

function salvarNome(){
  localStorage.setItem("nomeFuncionario",nomeFuncionario.value);
}
if(localStorage.getItem("nomeFuncionario"))
  nomeFuncionario.value=localStorage.getItem("nomeFuncionario");

function getEstado(){return localStorage.getItem("estado")||"FORA";}
function setEstado(e){
  localStorage.setItem("estado",e);
  statusAtual.innerText="Status: "+(e==="DENTRO"?"Em serviço":"Fora");
}
setEstado(getEstado());

function registrar(tipo){
  if(tipo==="ENTRADA"&&getEstado()==="DENTRO")return;
  if(tipo==="SAIDA"&&getEstado()==="FORA")return;
  const agora=new Date();
  const dados=JSON.parse(localStorage.getItem("pontos")||"[]");
  dados.push({tipo,iso:agora.toISOString()});
  localStorage.setItem("pontos",JSON.stringify(dados));
  setEstado(tipo==="ENTRADA"?"DENTRO":"FORA");
  ultimaAcao.innerText="Última ação: "+tipo+" às "+agora.toLocaleTimeString();
  statusEnvio.classList.remove("hidden");
}

function toggleRelatorio(){
  relatorio.style.display=relatorio.style.display==="none"?"block":"none";
}

function gerarRelatorio(){
  const nome=nomeFuncionario.value;
  tituloFuncionario.innerText="NOME: "+nome;
  const regs=JSON.parse(localStorage.getItem("pontos")||[]);
  let total=0,html="";
  for(let i=0;i<regs.length;i+=2){
    if(!regs[i+1])break;
    const e=new Date(regs[i].iso);
    const s=new Date(regs[i+1].iso);
    const min=Math.round((s-e)/60000);
    total+=min;
    html+=`${e.toLocaleDateString()} — ${e.toLocaleTimeString()} → ${s.toLocaleTimeString()}<br>`;
  }
  const h=String(Math.floor(total/60)).padStart(2,"0");
  const m=String(total%60).padStart(2,"0");
  boxTotalHoras.innerText=`TOTAL DE HORAS: ${h}h:${m}min`;
  conteudoRel.innerHTML=html||"<em>Nenhum registro.</em>";
}
</script>

</body>
</html>
